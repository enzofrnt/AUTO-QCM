<!-- app/templates/home.html -->
{% extends "base.html" %}

{% block content %}
<div class="main-content">
    <h1>Tableau de bord</h1>
    <p>Des quiz express, pour un succès qui progresse</p>
    <!-- utile ? -->
    <div class="buttons">
        EN COURS - afficher anciens qcm, faire des stats etc
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div id="calendar" style="width: 100%; height: 500px;"></div>
        </div>
        </div>
    </div>
    <!-- Liste des QCM contenant des questions du professeur -->
    <div class="card shadow-sm mb-3">
        <div class="card-header bg-primary text-white">
            <h3>Vos réponses aux QCM</h3>
        </div>
        <div class="card shadow-sm mb-3">
            <div class="card-body">
                <div style="max-height: 243px; overflow-y: auto;">
                    <ul class="list-group">
                        {% for reponse in reponse_qcm %}
                        <li class="list-group-item">
                            <strong>{{ reponse.qcm.titre }}</strong> - {{ reponse.qcm.date|date:"d/m/Y" }}
                            <ul>
                                <li>
                                    <a href="{% url 'qcm-correct' reponse.id %}">Voir ma réponse</a>
                                </li>
                            </ul>
                        </li>
                        {% empty %}
                        <li class="list-group-item">Aucun QCM trouvé.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        
    </div>

    
    
</div>
<!-- Script pour le calendrier FullCalendar -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var events = [
            {% for qcm in upcoming_qcms %}
            {
                title: '{{ qcm.titre|escapejs }}',
                start: '{{ qcm.date|date:"Y-m-d\\TH:i:s" }}',
                backgroundColor: getRandomColor(),
                borderColor: getRandomColor(),
                textColor: 'black',
                url: '{{ qcm.get_absolute_url|escapejs }}'  // Assurez-vous que chaque QCM a une URL définie dans le modèle
            },
            {% endfor %}
        ];

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            buttonText: {
                today: 'Aujourd\'hui',
                month: 'Mois',
                week: 'Semaine',
                day: 'Jour'
            },
            themeSystem: 'bootstrap',
            events: events,
            allDaySlot: false,
            eventMaxStack: 2,
            dayMaxEvents: 1, // This will limit the number of events displayed per day to at least one
            eventClick: function(info) {
                // Redirection vers l'URL de l'événement
                window.location.href = info.event.url;
            },
            views: {
                dayGridMonth: {
                    titleFormat: { year: 'numeric', month: 'long' }
                }
            },
            eventOrder: 'title', // Ordre des événements dans la pile
            eventDidMount: function(info) {
                if (info.view.type === 'dayGridMonth' && info.event._def.extendedProps.more) {
                    info.el.querySelector('.fc-daygrid-day-top').innerHTML += `<span class="fc-more-events">${info.event._def.extendedProps.more} more...</span>`;
                }
            }
        });

        calendar.render();
    });

    function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }
</script>

<style>
    .fc-daygrid-event {
        padding: 5px;
        font-size: 14px;
        border-radius: 5px;
    }

    .fc-more-events {
        display: inline-block;
        font-size: 12px;
        color: #007bff;
        cursor: pointer;
    }
    .fc-event {
        cursor: pointer; /* Ajoutez cette ligne pour changer le curseur en pointer */
    }
</style>
{% endblock %}
